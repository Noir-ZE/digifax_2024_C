# 问题三：磁芯损耗关键因素分析 解决方案说明

**贡献者:** @Noir-ZE
**最后更新时间:** 2025-09-01

---

## 1. 问题解析与核心目标

本部分旨在解决赛题中的**问题三：磁芯损耗影响因素分析**。

核心目标是基于附件一提供的全部实验数据，深入剖析**温度 (Temperature)**、**励磁波形 (Waveform_Type)** 和 **磁芯材料 (Material)** 这三个关键因素是如何独立及协同地影响磁芯损耗的。我们需要：
1.  **定性分析**各因素的影响趋势。
2.  **定量评估**各因素及其交互作用对总损耗的“贡献度”。
3.  基于上述分析，最终**找出**能够实现最低磁芯损耗的“最优工况组合”。

## 2. 核心思路与技术方案

我们采用 **探索性数据分析 (EDA)** 与 **统计推断模型** 相结合的方法论，通过“由表及里、由浅入深”的分析路径，系统地揭示数据背后的规律。

1.  **数据准备 (`3_1_data_prep.py`)**: 对数据进行必要的预处理，包括计算分析所需的**峰值磁通密度 `Bm`**，以及对因变量 `Core_Loss` 进行**对数变换**。对数变换是执行方差分析（ANOVA）前的关键步骤，旨在稳定方差、使数据分布更接近正态，从而满足模型的假设前提。

2.  **定性分析：看现象 (`3_2_fact_analy.py`)**:
    *   **独立效应分析**: 通过绘制**小提琴图 (Violin Plots)**，直观地观察单个因素（如不同温度）对磁芯损耗分布的总体影响。
    *   **协同效应分析**: 利用**交互效应图 (Interaction Plots)**，判断任意两个因素之间是否存在“1+1≠2”的相互作用。图中线条的**不平行**（尤其是交叉）是存在交互作用的强烈信号。

3.  **定量分析：抓本质 (`3_2_fact_analy.py`)**:
    *   构建**三因素方差分析 (Three-Way ANOVA)** 模型，这是本问题的核心统计工具。
    *   利用 ANOVA 的结果，特别是**偏Eta平方 (Partial Eta-Squared, ηp²)** 这一关键指标，来精确量化各因素（独立效应）及其交互项（协同效应）对磁芯损耗变异的“解释力”或“影响程度”。

4.  **综合研判：找最优 (`3_3_opti_cond.py`)**:
    *   基于 ANOVA 的量化结果，采用“**主导因素优先**”的策略。首先锁定影响力最大的因素，并找到其最优水平。
    *   然后，在主导因素最优的条件下，结合交互效应图，层层递进地“钻取”分析，找到次要因素的最优组合。
    *   最后，通过全局排序所有组合的平均损耗，验证并得出最终的全局最优条件。

## 3. 脚本文件说明

本解决方案包含三个独立的Python脚本，它们构成了一个完整的分析流程。

### `3_1_data_prep.py`
*   **功能**: 问题三专属数据准备模块。
*   **输入**: `train_data_combined.csv` (由问题一的脚本生成)。
*   **处理**:
    1.  加载全量数据。
    2.  计算并添加 `Bm`（峰值磁通密度）列。
    3.  对 `Core_Loss` 进行对数变换，生成 `log_Core_Loss` 列。
    4.  将 `Temperature`, `Waveform_Type`, `Material` 转换为分类数据类型，为统计分析做准备。
*   **输出**: `q3_analysis_data.csv` - 一个包含所有后续分析所需列的纯净数据集。

### `3_2_fact_analy.py`
*   **功能**: 核心统计分析与可视化模块。
*   **输入**: `q3_analysis_data.csv`。
*   **处理**:
    1.  **独立效应分析**: 绘制并保存小提琴图 (`q3_main_effects_violin_analysis.png`)。
    2.  **协同效应分析**: 绘制并保存三组交互效应图 (`q3_interaction_effects_analysis.png`)。
    3.  **影响量化**: 执行三因素ANOVA分析，在控制台打印详细的统计表格，并绘制偏Eta平方的条形图以直观展示各效应的影响力大小 (`q3_anova_effect_sizes.png`)。
*   **输出**: 三张PNG格式的可视化分析图表，以及控制台中详尽的ANOVA统计结果。

### `3_3_opti_cond.py`
*   **功能**: 最优条件探索与结论生成模块。
*   **输入**: `q3_analysis_data.csv`。
*   **处理**:
    1.  重新运行ANOVA以确认各因素影响力排序。
    2.  采用“主导因素优先”的策略，逐步分析并找出最优条件组合。
    3.  通过全局排序所有组合的平均损耗，进行最终验证。
*   **输出**: 控制台中清晰地打印出最优条件探索的全过程、分析逻辑以及最终的结论。同时生成一张主导因素分析图 (`q3_dominant_factor_loss.png`)。

## 4. 如何运行 (Step-by-Step Guide)

### 步骤 1: 环境准备
请确保您的Python环境中已安装以下必要的库：
```bash
pip install pandas numpy matplotlib seaborn pingouin statsmodels
```

### 步骤 2: 数据准备
*   请确保在运行本部分之前，**已经成功运行了问题一的 `1_1_data_prep.py`**，并生成了 `train_data_combined.csv` 文件。
*   将 `train_data_combined.csv` 文件与本问题的三个Python脚本 (`3_1_data_prep.py`, `3_2_fact_analy.py`, `3_3_opti_cond.py`) 放置在同一目录下。

### 步骤 3: 依次执行脚本
打开终端或命令行，进入脚本所在目录，然后按以下顺序执行脚本：

1.  **执行数据准备**
    ```bash
    python 3_1_data_prep.py
    ```
    *运行成功后，会生成 `q3_analysis_data.csv` 文件。*

2.  **执行核心统计分析**
    ```bash
    python 3_2_fact_analy.py
    ```
    *脚本会执行分析并生成三张核心的可视化图表，同时在控制台输出详细的ANOVA表格。*

3.  **执行最优条件探索**
    ```bash
    python 3_3_opti_cond.py
    ```
    *脚本会基于之前的分析，在控制台清晰地展示寻找最优解的逻辑过程，并给出最终的结论。*

---
至此，问题三的全部求解流程已完成。通过这个三步走的分析，我们不仅回答了“哪些因素有影响”，更精确地回答了“影响有多大”以及“如何组合以达到最优”。