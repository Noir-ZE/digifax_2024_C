# 问题二：斯坦麦茨方程修正解题大纲（迭代优化版）

**核心目标：** 针对传统斯坦麦茨方程（SE）在变温工况下预测精度下降的问题，构建并验证一个考虑温度影响的修正模型（MSE），并定量证明其优越性。

**研究范式：** 采纳一种**“诊断式建模 (Diagnostic Modeling)”**的研究范式，遵循“**基准建立 → 缺陷诊断 → 定向修正 → 性能验证**”四个核心步骤，确保整个研究过程的逻辑严密性与科学性。

---

### 1. 建模总体思路

本方案将严格遵循“诊断式建模”的框架，通过以下四个步骤系统性地解决问题：

1.  **数据准备与基准建立：** 筛选所需数据，并使用严谨的**非线性最小二乘法(NLLS)**拟合传统SE模型，将其确立为后续比较的基准。

2.  **缺陷诊断与修正依据探索：** **（新增优化环节）** 通过可视化分析，精准定位SE模型的预测误差与温度的强相关性。同时，通过分析“经验k值”与温度的关系，为提出的二次多项式修正形式提供强有力的数据支持。

3.  **构建修正模型并进行全局优化：** **（核心改进）** 提出修正的斯坦麦茨方程（MSE），并采用**全局同步优化的NLLS方法**，对MSE模型的所有参数进行同步拟合，以寻求全局最优解。

4.  **全方位性能验证与深度分析：** 从**定量指标**和**定性分析（可视化）**两个维度，对SE和MSE模型进行全方位的性能比较，并对结果进行深度解读，完成对修正模型有效性的论证。

---

### 2. 步骤一：数据准备与基准模型建立

*   **2.1 数据准备：**
    *   **筛选：** 从`train_data_combined.csv`中提取`Material == 1`且`Waveform_Type == 'sin'`的数据。
    *   **计算 $B_m$：** $B_m = (\max(B(t)) - \min(B(t))) / 2$。

*   **2.2 建立基准模型 (SE)：**
    *   **模型方程：**
        $$
        P_v(f, B_m; k, \alpha, \beta) = k \cdot f^\alpha \cdot B_m^\beta
        $$
    *   **参数拟合：** 采用**非线性最小二乘法 (NLLS)**，求解以下优化问题以确定参数 $\boldsymbol{\theta}_{SE} = (k, \alpha, \beta)$：
        $$
        \min_{\boldsymbol{\theta}_{SE}} \sum_{i=1}^{N} \left( P_{v,i}^{\text{actual}} - P_v(f_i, B_{m,i}; \boldsymbol{\theta}_{SE}) \right)^2
        $$

---

### 3. 步骤二：缺陷诊断与修正依据探索

*   **3.1 SE模型缺陷诊断：**
    *   **计算相对预测误差 (RPE):**
        $$
        \text{RPE}_i = \frac{P_{v,i}^{\text{actual}} - \hat{P}_{v,i}^{\text{SE}}}{P_{v,i}^{\text{actual}}} \times 100\%
        $$
    *   **可视化诊断：** 绘制**RPE与温度T的箱线图**，直观展示预测误差是否随温度发生系统性偏移。

*   **3.2 修正形式的探索性分析：**
    *   **目的：** 为“为何选择二次多项式修正k”提供数据依据。
    *   **计算经验k值 ($k_{emp}$):**
        $$
        k_{emp, i} = \frac{P_{v,i}^{\text{actual}}}{f_i^{\hat{\alpha}_{SE}} \cdot B_{m,i}^{\hat{\beta}_{SE}}}
        $$
    *   **可视化分析：** 绘制**$k_{emp}$与温度T的散点图**，并叠加二次多项式拟合曲线，以验证二次关系假设的合理性。

---

### 4. 步骤三：构建修正模型并进行全局优化

*   **4.1 构建修正斯坦麦茨方程 (MSE)：**
    *   **修正假设：** $k(T) = c_0 + c_1 T + c_2 T^2$
    *   **修正模型方程 (MSE)：**
        $$
        P_v(T, f, B_m; c_0, c_1, c_2, \alpha, \beta) = (c_0 + c_1 T + c_2 T^2) \cdot f^\alpha \cdot B_m^\beta
        $$

*   **4.2 全局同步参数优化 (NLLS)：**
    *   **优化目标：** 将模型的**全部五个参数** $\boldsymbol{\theta}_{MSE} = (c_0, c_1, c_2, \alpha, \beta)$ 作为一个整体，进行同步优化求解，避免分步拟合的次优风险。
        $$
        \min_{\boldsymbol{\theta}_{MSE}} \sum_{i=1}^{N} \left( P_{v,i}^{\text{actual}} - P_v(T_i, f_i, B_{m,i}; \boldsymbol{\theta}_{MSE}) \right)^2
        $$

---

### 5. 步骤四：全方位性能验证与深度分析

*   **5.1 定量指标对比：**
    *   **总体性能：** 在全部数据上，计算并比较SE和MSE模型的**RMSE**、**MAPE**和**决定系数($R^2$)**。
    *   **分温度性能：** 在四个温度等级下，分别计算并比较两个模型的MAPE。
    *   **结果呈现：** 将所有对比指标整合至一个总结性表格中。

*   **5.2 定性可视化对比：**
    *   **预测值 vs. 实际值对比图：** 为SE和MSE模型分别绘制此图，直观比较点簇的集中程度。
    *   **残差图对比：** 为两个模型分别绘制残差图，通过对比残差的随机性和模式，深度分析模型改进的效果。

*   **5.3 最终结论：**
    *   综合定量和定性分析结果，得出修正模型（MSE）在预测精度和泛化能力上均显著优于传统模型（SE）的最终结论。

---
这份大纲为您提供了一个逻辑严密、论证充分的叙事结构。接下来，请您提供脚本文件，我将帮助您将这个“蓝图”变为现实。