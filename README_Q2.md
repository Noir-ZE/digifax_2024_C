# 问题二：斯坦麦茨方程修正与验证 解决方案说明

**贡献者:** @Noir-ZE
**最后更新时间:** 2025-09-01

---

## 1. 问题解析与核心目标

本部分旨在解决赛题中的**问题二：修正斯坦麦茨方程**。

核心目标是解决传统斯坦麦茨方程（Steinmetz Equation, **SE**）因未考虑**温度**影响而在不同工况下预测精度下降的问题。我们的任务是：
1.  **量化**传统SE模型的局限性，证明其预测误差与温度存在显著的相关性。
2.  **提出并构建**一个修正的斯坦麦茨方程（Modified Steinmetz Equation, **MSE**），将温度作为一个关键自变量融入模型中。
3.  **验证**修正模型的有效性，证明其相比于传统模型，在预测精度和泛化能力上均有显著提升。

**研究对象**：为保证模型的可解释性和物理意义的清晰，我们聚焦于**材料1**在**正弦波**激励下的全部实验数据进行建模与分析。

## 2. 核心思路与技术方案

我们采用“**基准模型对比与修正**”的研究范式，通过严谨的步骤解决此问题：

1.  **数据准备 (`2_1_data_prep.py`)**:
    *   从问题一整合的数据 (`train_data_combined.csv`) 中，筛选出特定工况（材料1，正弦波）的数据子集。
    *   计算并添加核心物理量——**峰值磁通密度 `Bm`**。
    *   输出一个干净、专属的建模数据集 `q2_material1_sine_wave_data.csv`。

2.  **基准模型拟合与分析 (`2_2_fit_analy.py`)**:
    *   **拟合SE模型**: 使用**对数线性回归**方法，对不含温度项的传统SE模型进行参数拟合。这为我们提供了一个性能比较的“靶子”。
    *   **分析局限性**: 通过计算SE模型的**相对预测误差 (RPE)**，并绘制其与温度的**箱线图**，直观地揭示了传统模型在不同温度下存在系统性偏差，从而证明了修正的必要性。

3.  **修正模型构建与拟合 (`2_2_fit_analy.py`)**:
    *   **提出MSE模型**: 核心创新在于假设SE方程中的系数 `k` 是温度 `T` 的函数。我们选用二次多项式 `k(T) = c₀ + c₁T + c₂T²` 来表征这种非线性依赖关系，构建出新的MSE模型。
    *   **拟合MSE模型**: 采用巧妙的**两步回归法**对MSE模型的五个参数进行高效拟合。

4.  **效果验证与比较 (`2_2_fit_analy.py`)**:
    *   **定量对比**: 从**总体性能**（RMSE, MAPE, R²）和**分温度性能**（在每个温度等级下的MAPE）两个维度，对SE和MSE模型进行全方位、数字化的性能比较。
    *   **可视化对比**: 绘制**预测值 vs. 实际值**散点图和**残差图**，直观展示MSE模型预测结果的优越性（点更贴近y=x线，残差分布更均匀）。

## 3. 数学模型与拟合策略

### 传统斯坦麦茨方程 (SE)
$$
P_v = k \cdot f^\alpha \cdot B_m^\beta
$$
**拟合策略**: 对上式两边取对数，得到 `log(Pv) = log(k) + α·log(f) + β·log(Bm)`。这是一个标准的三元线性方程，可以使用线性回归快速求解出 `log(k)`, `α`, `β`。

### 修正斯坦麦茨方程 (MSE)
$$
P_v = (c_0 + c_1 T + c_2 T^2) \cdot f^\alpha \cdot B_m^\beta
$$
**拟合策略**: 采用两步法：
1.  **第一步**: 假设 `α` 和 `β` 在引入温度项后基本不变，直接**继承**从SE模型中拟合出的 `α` 和 `β` 值。
2.  **第二步**: 对于每个数据点，反向计算出经验系数 `k_empirical = Pv / (f^α · Bm^β)`。然后，对 `(T, k_empirical)` 这些数据点进行二次多项式拟合，求解出 `c₀`, `c₁`, `c₂`。

这种策略不仅计算高效，而且具有良好的物理可解释性。

## 4. 脚本文件说明

本解决方案包含两个独立的Python脚本，请务必按顺序执行。

### `2_1_data_prep.py`
*   **功能**: 问题二专属数据准备模块。
*   **输入**: `train_data_combined.csv` (由问题一的脚本生成)。
*   **处理**:
    1.  加载数据。
    2.  筛选出 `Material == 1` 且 `Waveform_Type == 'sin'` 的样本。
    3.  计算每个样本的峰值磁通密度 `Bm`。
*   **输出**: `q2_material1_sine_wave_data.csv` - 用于问题二建模的纯净数据集。

### `2_2_fit_analy.py`
*   **功能**: 模型拟合、分析与验证的核心模块。
*   **输入**: `q2_material1_sine_wave_data.csv`。
*   **处理**:
    1.  拟合SE模型并评估其参数。
    2.  通过绘制误差分析图，揭示SE模型的局限性。
    3.  构建并拟合MSE模型。
    4.  计算并打印SE和MSE模型的各项性能指标（RMSE, MAPE, R²）。
    5.  生成预测值vs实际值、残差图等可视化结果，直观对比模型效果。
*   **输出**:
    *   `q2_se_error_analysis.png`: SE模型误差与温度关系的箱线图。
    *   `q2_predictions_vs_actual.png`: 两个模型预测值与实际值的对比图。
    *   `q2_residuals_comparison.png`: 两个模型残差分布的对比图。
    *   控制台会打印出详细的参数拟合结果和性能对比表格。

## 5. 如何运行 (Step-by-Step Guide)

### 步骤 1: 环境准备
请确保您的Python环境中已安装以下必要的库：
```bash
pip install pandas numpy scikit-learn matplotlib seaborn
```

### 步骤 2: 数据准备
*   请确保在运行本部分之前，**已经成功运行了问题一的 `1_1_data_prep.py`**，并生成了 `train_data_combined.csv` 文件。
*   将 `train_data_combined.csv` 文件与本问题的两个Python脚本 (`2_1_data_prep.py`, `2_2_fit_analy.py`) 放置在同一目录下。

### 步骤 3: 依次执行脚本
打开终端或命令行，进入脚本所在目录，然后按以下顺序执行脚本：

1.  **执行数据准备**
    ```bash
    python 2_1_data_prep.py
    ```
    *运行成功后，会生成 `q2_material1_sine_wave_data.csv` 文件。*

2.  **执行模型拟合与分析**
    ```bash
    python 2_2_fit_analy.py
    ```
    *脚本会执行完整的分析流程，并在控制台打印出所有关键结果（模型参数、性能对比等）。同时，会生成三张PNG格式的可视化分析图表。*

---
至此，问题二的全部求解流程已完成。