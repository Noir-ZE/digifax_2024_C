# 问题一：励磁波形分类 解决方案说明

**贡献者:** @Noir-ZE
**最后更新时间:** 2025-09-01

---

## 1. 问题解析与核心目标

本部分旨在解决赛题中的**问题一：励磁波形分类**。

核心目标是利用附件一提供的包含磁通密度时间序列 `B(t)` 的训练数据，构建一个高精度、高泛化能力的机器学习模型，以自动识别三种励-**正弦波 (Sine)**、**三角波 (Triangular)** 和 **梯形波 (Trapezoidal)**。最终，利用此模型对附件二的未知波形数据进行分类，并按要求格式输出结果。

## 2. 核心思路与技术方案

我们将此问题建模为一个经典的多分类**监督学习**任务。整体技术路线遵循数据科学的最佳实践，分为以下几个关键步骤：

1.  **数据整合与预处理 (`1_1_data_prep.py`)**: 将分散的四个训练数据Excel文件合并为一个统一的CSV文件 (`train_data_combined.csv`)。此步骤为后续的特征工程和模型训练提供了便利、标准化的数据源。

2.  **特征工程 (`1_2_train_class.py`)**: 这是模型成功的基石。我们没有直接使用原始的1024个 `B(t)` 数据点，而是从中提取了一系列能够深刻揭示波形内在几何与物理特性的统计特征。这些特征从**时域、频域、导数形态**三个维度对波形进行全方位刻画。

3.  **模型构建与评估 (`1_2_train_class.py`)**:
    *   **模型选择**: 选用业界领先的 **LightGBM (Light Gradient Boosting Machine)** 算法。它以其卓越的预测精度、高效的训练速度和低内存消耗而闻名，是处理此类表格型特征数据的理想选择。
    *   **科学评估**: 采用**5折分层交叉验证 (5-Fold Stratified Cross-Validation)** 对模型的性能进行严谨评估。交叉验证准确率超过 **99.9%**，充分证明了我们特征工程的有效性和模型的合理性。

4.  **预测与结果生成 (`1_3_pred_resu.py`)**: 将经过充分训练和验证的最终模型应用于附件二的测试数据，生成最终的分类结果，并严格按照赛题要求格式化输出为 `附件四.xlsx`。

## 3. 关键特征工程详解

我们设计的特征体系旨在捕捉不同波形在“形状”上的本质差异。所有特征均在Z-score标准化后的 `B(t)` 序列上计算，以消除幅值和直流偏置的干扰。

| 特征类别 | 特征名称 | 设计原理与区分效果 |
| :--- | :--- | :--- |
| **时域统计** | **峭度 (Kurtosis)** | **核心特征**。衡量波形峰值的“尖锐度”。理论上，平顶的**梯形波**峭度最低，圆润的**正弦波**居中，而尖顶的**三角波**峭度最高。 |
| | **偏度 (Skewness)** | 衡量波形关于垂直轴的不对称性。对于理想的对称波形，此值接近0。 |
| | **波峰因子 (Crest Factor)** | 峰值与有效值之比，反映峰值的极端程度。 |
| **频域分析** | **总谐波失真 (THD)** | **核心特征**。衡量波形相对于纯正弦波的失真程度。理想**正弦波**THD趋近于0，而**三角波**和**梯形波**包含丰富的高次谐波，THD值显著更高。 |
| | **关键谐波比** | 进一步区分非正弦波。例如，三角波和梯形波在3次、5次谐波的能量分布上存在明显差异。 |
| **导数形态** | **导数的峭度** | **“王牌特征”**。此特征极大地放大了波形轮廓的差异：<br> - **三角波**的导数是**方波**（上下跳变），峭度极低（接近1）。<br> - **正弦波**的导数是**余弦波**，峭度适中（约1.5）。<br> - **梯形波**的导数是**脉冲串**（上升/下降段）和**零**（平顶/平底段），峭度最高。 |

这个精心设计的特征集为分类器提供了强大的判别信息，是模型取得近乎完美准确率的根本原因。

## 4. 脚本文件说明

本解决方案包含三个独立的Python脚本，请务必按顺序执行。

### `1_1_data_prep.py`
*   **功能**: 数据预处理模块。
*   **输入**: `Training_Data_1.xlsx`, `Training_Data_2.xlsx`, ...
*   **处理**:
    1.  自动查找并加载所有训练数据文件。
    2.  为每个文件的数据打上“材料”标签。
    3.  将所有数据合并成一个DataFrame。
    4.  清理并重命名列名（如将中文列名改为英文）。
*   **输出**: `train_data_combined.csv` - 一个整合、清洗完毕的训练数据集。

### `1_2_train_class.py`
*   **功能**: 特征工程与模型训练模块。
*   **输入**: `train_data_combined.csv`。
*   **处理**:
    1.  加载整合后的数据。
    2.  对每条 `B(t)` 序列应用 `extract_features` 函数，生成特征矩阵。
    3.  对“波形类别”标签进行编码。
    4.  使用5折交叉验证训练并评估LightGBM分类器性能。
    5.  在全部训练数据上训练最终模型。
*   **输出**:
    *   `waveform_classifier.joblib`: 训练好的最终分类器模型。
    *   `label_encoder.joblib`: 用于波形名称与数字编码相互转换的标签编码器。

### `1_3_pred_resu.py`
*   **功能**: 模型应用与结果生成模块。
*   **输入**: `Test_Data_2.xlsx`, `waveform_classifier.joblib`, `label_encoder.joblib`。
*   **处理**:
    1.  加载测试数据以及训练好的模型和编码器。
    2.  对测试数据执行与训练时完全相同的特征提取流程。
    3.  使用加载的模型进行预测。
    4.  将预测的数字标签解码回波形名称，并按题目要求映射为1, 2, 3。
*   **输出**: `附件四.xlsx` - 符合赛题要求的最终结果文件。

## 5. 如何运行 (Step-by-Step Guide)

### 步骤 1: 环境准备
请确保您的Python环境中已安装以下必要的库：
```bash
pip install pandas numpy scikit-learn lightgbm joblib tqdm openpyxl
```

### 步骤 2: 数据准备
请将以下文件放置在与上述三个Python脚本相同的目录下：
*   `Training_Data_1.xlsx`
*   `Training_Data_2.xlsx`
*   `Training_Data_3.xlsx`
*   `Training_Data_4.xlsx`
*   `Test_Data_2.xlsx`

### 步骤 3: 依次执行脚本
打开终端或命令行，进入脚本所在目录，然后按以下顺序执行脚本：

1.  **执行数据整合**
    ```bash
    python 1_1_data_prep.py
    ```
    *运行成功后，会生成 `train_data_combined.csv` 文件。*

2.  **执行模型训练**
    ```bash
    python 1_2_train_class.py
    ```
    *运行成功后，会打印出交叉验证的平均准确率，并生成 `waveform_classifier.joblib` 和 `label_encoder.joblib` 两个模型文件。*

3.  **执行预测并生成结果**
    ```bash
    python 1_3_pred_resu.py
    ```
    *运行成功后，会生成最终的结果文件 `附件四.xlsx`，并打印出附件二中各类波形的统计数量。*

---
至此，问题一的全部求解流程已完成。